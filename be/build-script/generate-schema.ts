import { parseTypeScriptSchema } from './schema-gen/typescript-type-parser';
import { generateEvolutionCRUD } from './schema-gen/evolution-crud-generator';
import { writeFileSync } from 'fs';

export function generateSchema(inputPath: string, outputPath: string): void {
  console.log(`üìñ Parsing TypeScript schema from: ${inputPath}`);
  
  const evolution = parseTypeScriptSchema(inputPath);
  
  if (evolution.documents.size === 0) {
    throw new Error('No documents found in the schema file');
  }

  console.log(`üìä Found ${evolution.documents.size} document(s):`);
  for (const [name, doc] of evolution.documents) {
    console.log(`  - ${name} (${doc.fields.length} fields)`);
  }

  console.log('‚öôÔ∏è  Generating TypeScript code...');
  
  // Generate CRUD functions
  const crudCode = generateEvolutionCRUD(evolution);
  
  // Combine everything
  const fullOutput = `// Auto-generated database functions
// Generated from: ${inputPath}
// Do not edit this file directly
// Generated at: ${new Date().toISOString()}

${crudCode}
`;

  console.log(`üíæ Writing output to: ${outputPath}`);
  writeFileSync(outputPath, fullOutput);
  
  console.log('‚úÖ Schema generation completed successfully!');
}